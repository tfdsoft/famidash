banked(sound_test_bank.func)
u8 num_to_ascii(u8 n){
    n &= 0x0f;
    if(n > 0x09) return (n + 0x37);
    return (n + 0x30);
}

banked(sound_test_bank.data)
const u8 pal_genericmenu[]={
    0x17,0x0f,0x10,0x30,
    0x17,0x0f,0x2a,0x39,
    0x17,0x11,0x21,0x30,
    0x17,0x0f,0x21,0x31 
};

banked(sound_test_bank.data)
const u8 nt_genericmenu[]={
0x04,0x01,0x04,0x46,0x06,0x01,0x04,0x0f,0x06,0x01,0x04,0x0a,0x19,0x04,0x02,0x05,
0x19,0x04,0x0f,0x05,0x19,0x04,0x02,0x01,0x04,0x06,0x09,0x0e,0x0f,0x0e,0x07,0x04,
0x11,0x0f,0x0e,0x0f,0x08,0x01,0x04,0x05,0x09,0x1e,0x1f,0x1e,0x17,0x04,0x06,0x74,
0x65,0x78,0x74,0x17,0x04,0x06,0x1f,0x1e,0x1f,0x08,0x01,0x04,0x06,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x03,0x19,0x01,0x04,
0x02,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x02,0x19,0x10,0x1c,0x01,0x01,0x0a,0x00,
0x04,0x15,0x0b,0x01,0x01,0x1d,0x10,0x0e,0x0f,0x08,0x09,0x1a,0x1b,0x0e,0x07,0x04,
0x05,0x0f,0x0e,0x07,0x07,0x0f,0x0e,0x07,0x04,0x05,0x0f,0x1a,0x1b,0x08,0x09,0x0e,
0x0f,0x1e,0x1f,0x1c,0x19,0x18,0x0d,0x1e,0x17,0x04,0x05,0x1f,0x1e,0x17,0x17,0x1f,
0x1e,0x17,0x04,0x05,0x1f,0x0c,0x18,0x19,0x1d,0x1e,0x1f,0x03,0x03,0x0e,0x0f,0x1c,
0x01,0x18,0x04,0x13,0x01,0x1d,0x0e,0x0f,0x03,0x03,0x02,0x02,0x1e,0x1f,0x10,0x08,
0x01,0x04,0x13,0x09,0x10,0x1e,0x1f,0x02,0x02,0x01,0x04,0x3f,0xa0,0x04,0x07,0xaa,
0x17,0x05,0x04,0x03,0x4d,0xaa,0xaa,0x11,0x00,0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,
0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,0x04,0x03,
0x44,0xaa,0x79,0xa6,0xa5,0xad,0xa7,0xa5,0xa9,0xd6,0x00,0x04,0x07,0x04,0x00
};

banked(sound_test_bank.data)
const char str_soundtest[] = "\x01sound\x01test\x01";

banked(sound_test_bank.data)
const char str_music[] = "MUSIC"; 

banked(sound_test_bank.data)
const char str_soundeffects[] = "SOUND EFFECTS";

banked(sound_test_bank.data)
const char str_byartist[] = "BY:";

banked(sound_test_bank.func)
void state_soundtest(){
    signed char selection = 0;
    unsigned char index[2] = {0,0};

    char bankstr[8];

    famistudio_music_stop();

    se_wait_vsync();
    se_vram_address(0x2000);
    se_vram_unrle(nt_genericmenu,0);

    se_set_palette_background(pal_genericmenu);

    se_string_vram_buffer(str_soundtest, 0x20aa);
    se_string_vram_buffer(str_music, 0x2127);
    se_string_vram_buffer(str_byartist, 0x21c7);
    se_string_vram_buffer(str_soundeffects, 0x2227);

    se_irq_table_position = 0;
    se_irq_ptr = nofunction;
    se_irq_table[0]=255;
    se_irq_table[1]=0x60; // location 0x60 (rts)
    se_irq_table[2]=0x81; // of the identity table

    set_chr_bank(2,0);
    set_chr_bank(3,1);
    set_chr_bank(4,2);
    set_chr_bank(5,3);
    set_chr_bank(0,4);
    set_chr_bank(1,6);

    se_turn_on_rendering();
    se_fade_palette_to(0,4);

    __asm__("cli");

    while(1){
        se_wait_vsync();

        se_gray_line();

        se_one_vram_buffer(0x00, (0x2126 + (selection << 8)));
        if(joypad1.press_down){selection++;}
        if(joypad1.press_up){selection--;}

        if(selection >= 2){selection = 0;}
        if(selection < 0){selection = 1;}
        se_one_vram_buffer('>', (0x2126 + (selection << 8)));


        if(joypad1.press_right){
            index[selection]++;
        }
        if(joypad1.press_left){
            index[selection]--;
        }

        if(lo(index) == 0xff){index[0]++;}
        if(hi(index) == 0xff){index[1]++;}
        if(lo(index) == song_max){index[0]--;}
        if(hi(index) == sfx_max){index[1]--;}

        se_one_vram_buffer_repeat_horizontal(' ', 17, (0x2168+(selection<<8)));
        if(selection == 0){
            se_one_vram_buffer_repeat_horizontal(' ', 17, 0x2188);
            unsigned char tmp = hi(xbgmtextsUpper[lo(index)]);
            if(tmp){
                se_string_vram_buffer(
                    xbgmtextsUpper[lo(index)],
                    0x2168
                );
            }
            se_string_vram_buffer(
                xbgmtextsLower[lo(index)],
                0x2188
            );
            se_one_vram_buffer_repeat_horizontal(' ', 14, 0x21cb);
            se_string_vram_buffer(
                xbgmtextsOriginalArtist[lo(index)],
                0x21cb
            );
        }
        if(selection == 1){
            se_string_vram_buffer(
                sfxtexts[hi(index)],
                0x2268
            );
        }

        bankstr[0] = num_to_ascii((__prg_8000>>4));
        bankstr[1] = num_to_ascii(__prg_8000);
        bankstr[2] = ':';
        bankstr[3] = num_to_ascii((*(u8*)0x24)>>4);
        bankstr[4] = num_to_ascii((*(u8*)0x24));
        bankstr[5] = num_to_ascii((*(u8*)0x23)>>4);
        bankstr[6] = num_to_ascii((*(u8*)0x23));
        bankstr[7] = 0;

        se_string_vram_buffer(
            bankstr,
            nametable_address_A(6,23)
        );

        se_one_vram_buffer(
            num_to_ascii(index[selection]),
            0x2138 + (selection << 8)
        );
        se_one_vram_buffer(
            num_to_ascii((index[selection]>>4)),
            0x2137 + (selection << 8)
        );



        if(joypad1.press_a) {
            switch(selection){
                case 0:
                    se_music_play(xbgmlookuptable[lo(index)]);
                    break;
                case 1:
                    se_sfx_play(hi(index),0);
                    break;
            }
        }
        if(joypad1.press_start) {
            famistudio_music_stop();
        }

        if(joypad1.press_select) {
            //if(!selection){
            //    se_sfx_play(sfx_counter003,0);
            //    saved_menu_theme = xbgmlookuptable[lo(index)];
            //}
            se_play_sample(0,0,1);
        }
        

        if(joypad1.press_b) {
            gamestate = 0x10;
            se_fade_palette_to(4,0);
            break;
        }
    }
    
}



banked(debug_bank.data) const char str_gsjmp[] = "GAMESTATE JUMPER";
banked(debug_bank.data) const u8 pal_gsjmp[] = {
    0x0f, 0x00, 0x10, 0x20,
    0x0f, 0x24, 0x24, 0x24,
    0x0f, 0x24, 0x24, 0x24,
    0x0f, 0x24, 0x24, 0x24,
};

banked(debug_bank.func) void state_gamestatejumper(){

    se_vram_address(0);
    se_memory_fill((void*)0x2007, 0, 0x100);
    se_vram_donut_decompress(chr_menu_font_pusab, chr_bank_0);

    se_vram_address(0x2000);
    se_memory_fill((void*)0x2007, 0, 0x400);

    se_set_palette_all(pal_gsjmp);
    se_set_palette_brightness_all(4);

    se_vram_address(nametable_address_A(8,11));
    se_memory_copy((void*)0x2007,(void*)str_gsjmp, sizeof(str_gsjmp)-1);

    se_turn_on_rendering();
    while(1){
        se_wait_vsync();

        gamestate += joypad1.press_right;
        gamestate -= joypad1.press_left;
        gamestate += (joypad1.press_up << 4);
        gamestate -= (joypad1.press_down << 4);

        se_one_vram_buffer(
            num_to_ascii(gamestate),
            nametable_address_A(16,14)
        );
        se_one_vram_buffer(
            num_to_ascii((gamestate>>4)),
            nametable_address_A(15,14)
        );

        


        if(joypad1.press_start){
            break;
        }
    }
}