banked(sound_test_bank.func)
u8 num_to_ascii(u8 n){
    n &= 0x0f;
    if(n > 0x09) return (n + 0x37);
    return (n + 0x30);
}

banked(sound_test_bank.data)
const unsigned char pal_genericmenu[16]={
    0x17,0x0f,0x10,0x30,
    0x17,0x0f,0x2a,0x39,
    0x17,0x11,0x21,0x30,
    0x17,0x0f,0x21,0x31 
};

banked(sound_test_bank.data)
const unsigned char nt_genericmenu[351]={
0x04,0x01,0x04,0x46,0x06,0x01,0x04,0x0f,0x06,0x01,0x04,0x0a,0x19,0x04,0x02,0x05,
0x19,0x04,0x0f,0x05,0x19,0x04,0x02,0x01,0x04,0x06,0x09,0x0e,0x0f,0x0e,0x07,0x04,
0x11,0x0f,0x0e,0x0f,0x08,0x01,0x04,0x05,0x09,0x1e,0x1f,0x1e,0x17,0x04,0x06,0x74,
0x65,0x78,0x74,0x17,0x04,0x06,0x1f,0x1e,0x1f,0x08,0x01,0x04,0x06,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,
0x15,0x0b,0x01,0x04,0x07,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x03,0x19,0x01,0x04,
0x02,0x0a,0x00,0x04,0x15,0x0b,0x01,0x04,0x02,0x19,0x10,0x1c,0x01,0x01,0x0a,0x00,
0x04,0x15,0x0b,0x01,0x01,0x1d,0x10,0x0e,0x0f,0x08,0x09,0x1a,0x1b,0x0e,0x07,0x04,
0x05,0x0f,0x0e,0x07,0x07,0x0f,0x0e,0x07,0x04,0x05,0x0f,0x1a,0x1b,0x08,0x09,0x0e,
0x0f,0x1e,0x1f,0x1c,0x19,0x18,0x0d,0x1e,0x17,0x04,0x05,0x1f,0x1e,0x17,0x17,0x1f,
0x1e,0x17,0x04,0x05,0x1f,0x0c,0x18,0x19,0x1d,0x1e,0x1f,0x03,0x03,0x0e,0x0f,0x1c,
0x01,0x18,0x04,0x13,0x01,0x1d,0x0e,0x0f,0x03,0x03,0x02,0x02,0x1e,0x1f,0x10,0x08,
0x01,0x04,0x13,0x09,0x10,0x1e,0x1f,0x02,0x02,0x01,0x04,0x3f,0xa0,0x04,0x07,0xaa,
0x17,0x05,0x04,0x03,0x4d,0xaa,0xaa,0x11,0x00,0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,
0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,0x04,0x03,0x44,0xaa,0xaa,0x11,0x00,0x04,0x03,
0x44,0xaa,0x79,0xa6,0xa5,0xad,0xa7,0xa5,0xa9,0xd6,0x00,0x04,0x07,0x04,0x00
};

banked(sound_test_bank.data)
const char str_soundtest[] = "\x01sound\x01test\x01";

banked(sound_test_bank.data)
const char str_music[] = "MUSIC"; 

banked(sound_test_bank.data)
const char str_soundeffects[] = "SOUND EFFECTS";

banked(sound_test_bank.data)
const char str_byartist[] = "BY:";

banked(sound_test_bank.func)
void state_soundtest(){
    signed char selection = 0;
    unsigned char index[2] = {0,0};

    famistudio_music_stop();

    se_vram_address(0x2000);
    se_vram_unrle(nt_genericmenu,0);

    se_set_palette_background(pal_genericmenu);

    se_string_vram_buffer(str_soundtest, 0x20aa);
    se_string_vram_buffer(str_music, 0x2127);
    se_string_vram_buffer(str_byartist, 0x21c7);
    se_string_vram_buffer(str_soundeffects, 0x2227);

    se_irq_table_position = 0;
    se_irq_ptr = nofunction;
    se_irq_table[0]=255;
    se_irq_table[1]=0x60; // location 0x60 (rts)
    se_irq_table[2]=0x81; // of the identity table

    se_turn_on_rendering();
    se_fade_palette_to(0,4);

    while(1){
        se_wait_vsync();


        se_one_vram_buffer(0x00, (0x2126 + (selection << 8)));
        if(joypad1.press_down){selection++;}
        if(joypad1.press_down){selection--;}

        if(selection >= 2){selection = 0;}
        if(selection < 0){selection = 1;}
        se_one_vram_buffer('>', (0x2126 + (selection << 6)));


        if(joypad1.press_right){
            index[selection]++;
        }
        if(joypad1.press_left){
            index[selection]--;
        }

        if(lo(index) == 0xff){index[0]++;}
        if(hi(index) == 0xff){index[1]++;}
        if(lo(index) == song_max){index[0]--;}
        if(hi(index) == sfx_max){index[1]--;}

        se_one_vram_buffer_repeat_horizontal(' ', 17, (0x2168+(selection<<8)));
        if(selection == 0){
            se_one_vram_buffer_repeat_horizontal(' ', 17, 0x2188);
            unsigned char tmp = hi(xbgmtextsUpper[lo(index)]);
            if(tmp){
                se_string_vram_buffer(
                    xbgmtextsUpper[lo(index)],
                    0x2168
                );
            }
            se_string_vram_buffer(
                xbgmtextsLower[lo(index)],
                0x2188
            );
            se_one_vram_buffer_repeat_horizontal(' ', 14, 0x21cb);
            se_string_vram_buffer(
                xbgmtextsOriginalArtist[lo(index)],
                0x21cb
            );
        }
        if(selection == 1){
            se_string_vram_buffer(
                sfxtexts[hi(index)],
                0x2268
            );
        }

        se_one_vram_buffer(
            num_to_ascii(index[selection]),
            0x2138 + (selection << 8)
        );
        se_one_vram_buffer(
            num_to_ascii((index[selection]>>4)),
            0x2137 + (selection << 8)
        );



        if(joypad1.press_a) {
            switch(selection){
                case 0:
                    se_music_play(xbgmlookuptable[lo(index)]);
                    break;
                case 1:
                    se_sfx_play(hi(index),0);
                    break;
            }
        }
        if(joypad1.press_start) {
            famistudio_music_stop();
        }

        if(joypad1.press_select) {
            if(!selection){
                se_sfx_play(sfx_counter003,0);
                saved_menu_theme = xbgmlookuptable[lo(index)];
            }
        }
        

        if(joypad1.press_b) {
            gamestate = 0x10;
            se_fade_palette_to(4,0);
            break;
        }
    }
    
}