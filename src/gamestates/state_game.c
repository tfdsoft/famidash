putinbank(extra_code_bank.menu.nt)
const uint8_t nt_da_ground[216]={
0x01,0x00,0x01,0xfe,0x00,0x01,0xfe,0x00,0x01,0xfe,0x00,0x01,0x02,0x40,0x42,0x44,
0x46,0x48,0x4a,0x4c,0x4e,0x40,0x42,0x44,0x46,0x48,0x4a,0x4c,0x4e,0x40,0x42,0x44,
0x46,0x48,0x4a,0x4c,0x4e,0x40,0x42,0x44,0x46,0x48,0x4a,0x4c,0x4e,0x41,0x43,0x45,
0x47,0x49,0x4b,0x4d,0x4f,0x41,0x43,0x45,0x47,0x49,0x4b,0x4d,0x4f,0x41,0x43,0x45,
0x47,0x49,0x4b,0x4d,0x4f,0x41,0x43,0x45,0x47,0x49,0x4b,0x4d,0x4f,0x50,0x52,0x54,
0x56,0x58,0x5a,0x5c,0x5e,0x50,0x52,0x54,0x56,0x58,0x5a,0x5c,0x5e,0x50,0x52,0x54,
0x56,0x58,0x5a,0x5c,0x5e,0x50,0x52,0x54,0x56,0x58,0x5a,0x5c,0x5e,0x51,0x53,0x55,
0x57,0x59,0x5b,0x5d,0x5f,0x51,0x53,0x55,0x57,0x59,0x5b,0x5d,0x5f,0x51,0x53,0x55,
0x57,0x59,0x5b,0x5d,0x5f,0x51,0x53,0x55,0x57,0x59,0x5b,0x5d,0x5f,0x60,0x62,0x64,
0x66,0x68,0x6a,0x6c,0x6e,0x60,0x62,0x64,0x66,0x68,0x6a,0x6c,0x6e,0x60,0x62,0x64,
0x66,0x68,0x6a,0x6c,0x6e,0x60,0x62,0x64,0x66,0x68,0x6a,0x6c,0x6e,0x61,0x63,0x65,
0x67,0x69,0x6b,0x6d,0x6f,0x61,0x63,0x65,0x67,0x69,0x6b,0x6d,0x6f,0x61,0x63,0x65,
0x67,0x69,0x6b,0x6d,0x6f,0x61,0x63,0x65,0x67,0x69,0x6b,0x6d,0x6f,0x00,0x01,0x2f,
0x55,0x01,0x07,0x05,0x01,0x07,0x01,0x00
};

putinbank(fixed_lo.pal)
const unsigned char pal_game_default[32]={ 
    0x21,0x0f,0x11,0x30,
    0x21,0x02,0x12,0x32,
    0x21,0x0f,0x0f,0x0f,
    0x21,0x0f,0x0f,0x0f,

    0x21,0x0f,0x2a,0x2c,
    0x21,0x0f,0x24,0x28,
    0x21,0x0f,0x26,0x30,
    0x21,0x0f,0x2a,0x2c,
 };



putinbank(fixed_lo.game)
void state_game(){
    uint16_t scroll_bank = 0;

    // PAGE 0 (global stuff)
    set_bg_chr_page(0);
    donut_decompress_vram(chr_tiles_global,chr_bank_1); //1k
    donut_decompress_vram(chr_g[ground_set],chr_bank_3); //1k
    //set_1k_chr_1((high_byte(scroll_bank) + 0x10));
    // TODO: pause menu graphics in page 0

    // PAGE 1 (tiles)
    vram_adr(0);
    set_bg_chr_page(1);
    donut_decompress_vram(chr_tiles_grid,chr_bank_1); //256b
    donut_decompress_vram(chr_tiles_grid,chr_bank_1); //256b
    donut_decompress_vram(chr_tiles_grid,chr_bank_1); //256b
    donut_decompress_vram(chr_tiles_grid,chr_bank_1); //256b


    if(loaded_bg_set != background_set){
        donut_decompress_vram(chr_bg[background_set], chr_bank_2);
        vram_generate_parallax(background_set);
        loaded_bg_set = background_set;
    }

    // CLEAR COLLISION BUFFER
    memfill(coll_buffer,0,(16*12));
    memfill(&coll_buffer[(16*12)],1,(16*3));

    pal_all(pal_game_default);

    // CLEAR NAMETABLES
    set_prg_a000(extra_code_bank);
    vram_adr(0x2000);
    vram_write_parallax(loaded_bg_set);
    vram_write_parallax(loaded_bg_set);
    vram_adr(0x2000);
    vram_unrle_ignore0(nt_da_ground);
    vram_unrle_ignore0(nt_da_ground);

    set_bg_chr_page(0);

    add_advanced_interrupt(
        0,
        irq_set_chr,
        args88(3,0x10)
    ); 
    add_advanced_interrupt(
        189,
        irq_set_chr,
        args88(3,1)
    ); 
    enable_irq();

    

    ppu_on_all();
    pal_fade_to(0,4);

    player.x.word = 0;
    player.y.word = 0;
    player.width = player.height = 15;

    automatic_fs_updates = 0;
    music_play(song_stereo_madness);
    while(1){
        ppu_wait_nmi();
        ppu_emphasis(0b111);
        music_update();
        

        ppu_emphasis(0b000);

        run_player_collision();

        camera.x.word = (player.x.word - 0x60);

        high_byte(scroll_bank) &= 0x3f;
        scroll_bank -= (
            (phys_speed[player.prop.speed]>>2) +
            (phys_speed[player.prop.speed]>>3)
        );
        if(high_byte(scroll_bank) & 0x80) high_byte(scroll_bank) += loaded_bg_width;
        IRQ(0).arg1 = (high_byte(scroll_bank) + 0x10);

        oam_clear();
        oam_spr(
            (player.x.lo - camera.x.lo),
            (player.y.lo - camera.y.lo),
            0,
            0
        );
        oam_spr(
            (player.x.lo - camera.x.lo)+8,
            (player.y.lo - camera.y.lo),
            2,
            0
        );

        if(player1_pressed & PAD_B){
            gamestate = return_gamestate;
            famistudio_music_stop();
            sfx_play(sfx_quitsound_01,0);
            automatic_fs_updates = 1;
            pal_fade_to(4,0);
            break;
        }
        if(player1_pressed & PAD_RIGHT) player.prop.speed++;

        scroll(camera.x.word, camera.y.word);
    }
}